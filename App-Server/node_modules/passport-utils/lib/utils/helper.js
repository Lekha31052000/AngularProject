var url = require('url');
/**
 * Reconstructs the original URL of the request.
 *
 * This function builds a URL that corresponds the original URL requested by the
 * client, including the protocol (http or https) and host.
 *
 * If the request passed through any proxies that terminate SSL, the
 * `X-Forwarded-Proto` header is used to detect if the request was encrypted to
 * the proxy.
 *
 * @return {String}
 * @api private
 */
exports.originalURL = function(req) {
  var headers = req.headers
    , protocol = (req.connection.encrypted || req.headers['x-forwarded-proto'] == 'https')
               ? 'https'
               : 'http'
    , host = headers.host
    , path = req.url || '';
  return protocol + '://' + host + path;
};
/**
 * resolve a path to a URI.
 * @param {IncomingMessage} req
 * @param {String} path
 * @returns {String}
 */
exports.resolvePathToURI = function(req, path){
    var parsed = url.parse(path);
    if (parsed.protocol) {
        return path;
    }
    // The callback URL is relative, resolve a fully qualified URL from the
    // URL of the originating request.
    return url.resolve(exports.originalURL(req), path);
}
/**
 * Merge object b with object a.
 *
 *     var a = { foo: 'bar' }
 *       , b = { bar: 'baz' };
 *     
 *     utils.merge(a, b);
 *     // => { foo: 'bar', bar: 'baz' }
 *
 * @param {Object} a
 * @param {Object} b
 * @return {Object}
 * @api private
 */

exports.merge = function(a, b){
  if (a && b) {
    for (var key in b) {
      a[key] = b[key];
    }
  }
  return a;
};

// Returns true if this is a host that closes *before* it ends?!?!
exports.isAnEarlyCloseHost = function( hostName ) {
    return hostName && hostName.match(".*google(apis)?.com$");
}
